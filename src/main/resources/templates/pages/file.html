<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>file upload preview</title>
</head>
<body>

<input type="file" id="input-file">
<img id="preview-image" style="max-width:300px; max-height:300px;">
<a href="" id="save-file">ë“±ë¡</a>

<script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
<script>

    // íŒŒì¼ ë¯¸ë¦¬ë³´ê¸°

    // 1. FileReader ìƒì„± â†’ 2. ì½ê¸° ì™„ë£Œ ì‹œ ì‹¤í–‰ í•¨ìˆ˜ ì •ì˜ â†’ 3. íŒŒì¼ ì½ê¸° ì‹œì‘ â†’ 4. ì½ì€ íŒŒì¼ì„ ì´ë¯¸ì§€ srcì— ë„£ì–´ì„œ ë¯¸ë¦¬ë³´ê¸°ğŸ¨
    const previewImage = (fileInput, previewSelector) => {
        const file = fileInput.files[0];
        if (!file) return;
        const reader = new FileReader();
        reader.onload = (e) => $(previewSelector).attr("src", e.target.result); // e.target.result : ì½ì–´ì˜¨ íŒŒì¼ì˜ ë‚´ìš©
        reader.readAsDataURL(file);

    }


    // const saveFile = () => {
    //     const file = document.querySelector("#input-file").files[0];
    //     if (!file) return alert("íŒŒì¼ì„ ì„ íƒí•´ì£¼ì„¸ìš”!");
    //
    //     const fileData = new FormData();
    //     fileData.append("file", file);
    //
    //     const apiUrl = "/api/file"
    //
    //     fetch(apiUrl, {method: "POST", body: fileData})
    //         .then(res => res.json())
    //         .then(data => console.log("ì—…ë¡œë“œ ì„±ê³µ", data))
    //         .catch(err => console.log("ì—…ë¡œë“œ ì‹¤íŒ¨", err));
    //
    // }

    const saveFile = async () => {
        const file = $("#input-file")[0].files[0];
        if (!file) return alert("íŒŒì¼ì„ ì„ íƒí•´ì£¼ì„¸ìš”!");

        const apiUrl = "/file/upload"
        const formData = new FormData();
        formData.append("file", file);

        try {
            const res = await fetch(apiUrl, {method: "POST", body: formData});
            if (!res.ok) throw new Error("ì—…ë¡œë“œ ì‹¤íŒ¨");

            const data = await res.json();
            console.log("ì—…ë¡œë“œ ì„±ê³µ:", data);
            alert("ì—…ë¡œë“œ ì„±ê³µ!");
        } catch (err) {
            console.error(err);
            alert("ì—…ë¡œë“œ ì‹¤íŒ¨");
        }

    }


    $(document).ready(() => {

        // ì´ë¯¸ì§€ íŒŒì¼ ë¯¸ë¦¬ë³´ê¸°
        $("#input-file").on("change", e => previewImage(e.target, "#preview-image"));

        // íŒŒì¼ ì €ì¥
        //$("#save-file").on("click", e => saveFile());
        document.querySelector("#save-file").addEventListener("click", saveFile);

    })

    //    $(() => {}) ==  $(document).ready(() => {})


    // function previewImage(inputElement, previewElement) {
    //     const file = inputElement.files[0];
    //     const reader = new FileReader();
    //     reader.onload = function (e) { // íŒŒì¼ ì½ê¸°ê°€ ëë‚¬ì„ ë•Œ ì‹¤í–‰í•  í•¨ìˆ˜ë¥¼ ì •ì˜
    //         $(previewElement).attr("src", e.target.result); // ì„ íƒí•œ íŒŒì¼ì„ urlí˜•ì‹(base64)ìœ¼ë¡œ ì½ì–´ì˜¤ë¼ëŠ” ëª…ë ¹ (ë¸Œë¼ìš°ì €ì—ì„œ ì´ë¯¸ì§€ë¥¼ ë°”ë¡œ í‘œì‹œí•  ìˆ˜ ìˆë‹¤)
    //     }
    //     reader.readAsDataURL(file);
    // }


</script>
</body>


</html>

